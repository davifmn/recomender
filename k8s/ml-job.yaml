apiVersion: batch/v1
kind: Job
metadata:
  # Nome do Job. Ele vai criar um Pod com um sufixo aleatório.
  name: davineves-recomender-training-job
spec:
  template:
    spec:
      containers:
      - name: training-container
        # Imagem que contém seu script de treinamento
        image: davifmn/recomender-ia:latest
        
        # --- CORREÇÃO APLICADA AQUI ---
        # Alterado para executar um script de treinamento que termina após a execução,
        # em vez de iniciar uma API.
        command: ["python", "/app/train.py"]
        
        # Monta o "disco" (PVC) no diretório /data dentro do contêiner.
        # O script de treinamento deve salvar o modelo em /data/
        volumeMounts:
        - name: model-storage
          mountPath: /data
      
      # Define qual PVC (PersistentVolumeClaim) usar
      volumes:
      - name: model-storage
        persistentVolumeClaim:
          # O nome deve ser exatamente o mesmo do arquivo persistent-volume-claim.yaml
          claimName: davineves-model-pvc
          
      # Garante que, se o Job falhar, ele não tentará reiniciar indefinidamente.
      restartPolicy: Never
  # O Job tentará executar até 3 vezes em caso de falha.
  backoffLimit: 3
